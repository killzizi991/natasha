<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ежедневник мастера</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
            --light: #f8f9fa;
            --border: #e0e0e0;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background: #f5f5f5;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .month-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid var(--border);
            padding: 8px;
            text-align: left;
        }
        th {
            background: var(--primary);
            color: white;
        }
        .day-number {
            width: 30px;
            text-align: center;
        }
        .expenses {
            background: white;
            padding: 15px;
            border-radius: 5px;
        }
        .actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 10px;
            display: flex;
            gap: 10px;
            border-top: 1px solid var(--border);
        }
        button {
            padding: 10px;
            border: none;
            background: var(--primary);
            color: white;
            border-radius: 5px;
            flex: 1;
        }
        .add-btn {
            background: var(--accent);
        }
    </style>
</head>
<body>
    <header>
        <h2>Ежедневник</h2>
        <div class="month-nav">
            <button id="prev-month">←</button>
            <div id="current-month">Июнь 2025</div>
            <button id="next-month">→</button>
        </div>
    </header>

    <table>
        <thead>
            <tr>
                <th>День</th>
                <th>Запись/Имя/Время</th>
                <th>Цена</th>
                <th>Планы</th>
            </tr>
        </thead>
        <tbody id="calendar-body">
            <!-- Строки будут добавлены скриптом -->
        </tbody>
    </table>

    <div class="expenses">
        <h3>Расходы за месяц</h3>
        <div id="expenses-list"></div>
        <div style="margin-top: 15px;">
            <strong>Итого расходов:</strong> <span id="total-expenses">0</span> руб
        </div>
    </div>

    <div class="actions">
        <button class="add-btn" id="add-record">+ Запись</button>
        <button id="add-expense">+ Расход</button>
    </div>

    <script>
        // Данные
        let records = [];
        let expenses = [];
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        // Инициализация
        function init() {
            loadData();
            renderCalendar();
            renderExpenses();
            
            // Навигация по месяцам
            document.getElementById('prev-month').addEventListener('click', () => {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                updateMonthDisplay();
                renderCalendar();
                renderExpenses();
            });
            
            document.getElementById('next-month').addEventListener('click', () => {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                updateMonthDisplay();
                renderCalendar();
                renderExpenses();
            });
            
            updateMonthDisplay();
        }

        // Загрузка/сохранение данных
        function loadData() {
            const saved = localStorage.getItem('diaryData');
            if (saved) {
                const data = JSON.parse(saved);
                records = data.records || [];
                expenses = data.expenses || [];
            }
        }
        
        function saveData() {
            localStorage.setItem('diaryData', JSON.stringify({
                records,
                expenses
            }));
        }

        // Отрисовка календаря
        function renderCalendar() {
            const tbody = document.getElementById('calendar-body');
            tbody.innerHTML = '';
            
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            for (let day = 1; day <= 31; day++) {
                const row = document.createElement('tr');
                
                // Ячейка с номером дня
                const dayCell = document.createElement('td');
                dayCell.className = 'day-number';
                dayCell.textContent = day <= daysInMonth ? day : '';
                
                // Ячейка с записями
                const entriesCell = document.createElement('td');
                
                // Ячейка с ценами
                const priceCell = document.createElement('td');
                
                // Ячейка с планами
                const plansCell = document.createElement('td');
                
                if (day <= daysInMonth) {
                    const dateStr = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                    const dayRecords = records.filter(r => r.date === dateStr);
                    
                    // Записи (услуги)
                    const services = dayRecords.filter(r => r.type === 'service');
                    services.forEach(service => {
                        const entry = document.createElement('div');
                        entry.textContent = `${service.time || ''} ${service.client}`;
                        entriesCell.appendChild(entry);
                        
                        const price = document.createElement('div');
                        price.textContent = `${service.price} руб`;
                        priceCell.appendChild(price);
                    });
                    
                    // Планы
                    const plans = dayRecords.filter(r => r.type === 'plan');
                    plans.forEach(plan => {
                        const item = document.createElement('div');
                        item.textContent = plan.text;
                        plansCell.appendChild(item);
                    });
                }
                
                row.appendChild(dayCell);
                row.appendChild(entriesCell);
                row.appendChild(priceCell);
                row.appendChild(plansCell);
                tbody.appendChild(row);
            }
        }

        // Отрисовка расходов
        function renderExpenses() {
            const list = document.getElementById('expenses-list');
            list.innerHTML = '';
            
            const monthExpenses = expenses.filter(e => {
                const [year, month] = e.date.split('-');
                return parseInt(month) === currentMonth + 1 && parseInt(year) === currentYear;
            });
            
            if (monthExpenses.length === 0) {
                list.innerHTML = '<div>Нет расходов</div>';
            } else {
                monthExpenses.forEach(expense => {
                    const item = document.createElement('div');
                    item.textContent = `${expense.name}: ${expense.amount} руб`;
                    list.appendChild(item);
                });
            }
            
            // Итого расходов
            const total = monthExpenses.reduce((sum, e) => sum + e.amount, 0);
            document.getElementById('total-expenses').textContent = total;
        }

        // Обновление отображения месяца
        function updateMonthDisplay() {
            const months = ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 
                          'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];
            document.getElementById('current-month').textContent = `${months[currentMonth]} ${currentYear}`;
        }

        // Запуск приложения
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
